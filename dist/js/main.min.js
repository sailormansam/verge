var Block=function(t,e,i,a){t+=.5,e+=.5,this.sprite,this.width=i,this.height=i,this.x=t*this.width,this.y=e*this.height,this.type=a,this.create()};Block.prototype={create:function(){var t=game.add.graphics(0,0);this.type==blockType.STATIC?t.beginFill(6710886):t.beginFill(10066329),t.drawRect(0,0,this.width,this.height),this.sprite=game.add.sprite(this.x,this.y,t.generateTexture()),t.destroy(),game.physics.p2.enable(this.sprite),this.sprite.body.dynamic=!1}};var GameStates=GameStates||{},textStyle={normal:{font:"3em squada one",fill:"#333"},large:{font:"6em squada one",fill:"#333"}};GameStates.Boot=function(t){},GameStates.Boot.prototype={init:function(){this.input.maxPointers=1,game.stage.backgroundColor="#ffffff",game.canvas.oncontextmenu=function(t){t.preventDefault()}},create:function(){game.state.start("Preloader")}};var blockType={STATIC:"STATIC",MOVEABLE:"MOVEABLE"};GameStates.Game=function(t){this.player=null,this.level=0,this.block=[],this.teleporter,this.map,this.graphics,this.originPointer,this.mapGrain=40,this.blockLayer,this.GRAVITY=1e3},GameStates.Game.prototype={create:function(){game.physics.startSystem(Phaser.Physics.P2JS),game.physics.p2.defaultRestitution=1,game.physics.p2.gravity.y=this.GRAVITY,game.physics.p2.damping=1,this.map=JSON.parse(JSON.stringify(game.cache.getJSON("map"))),this.blockLayer=game.add.group(),this.graphics=game.add.graphics(0,0),this.graphics.alpha=.5,this.makeLevel(this.level),game.camera.follow(this.player.sprite),game.input.mouse.capture=!0},update:function(){if(this.player.update(),game.input.activePointer.leftButton.isDown&&this.placeBlock(game.input),this.graphics.clear(),game.input.activePointer.rightButton.isDown)null==this.originPointer&&(this.originPointer={x:game.input.x,y:game.input.y}),this.drawNet(game.input);else{if(null!=this.originPointer){var t={x:null,y:null},e={x:null,y:null};this.originPointer.x<game.input.x?(t.x=this.originPointer.x,e.x=game.input.x):(t.x=game.input.x,e.x=this.originPointer.x),this.originPointer.y<game.input.y?(t.y=this.originPointer.y,e.y=game.input.y):(t.y=game.input.y,e.y=this.originPointer.y);for(var i=new Phaser.Rectangle(t.x,t.y,e.x-t.x,e.y-t.y),a=0,s=this.block.length;s>a;a++)null!=this.block[a]&&this.player.inventory<this.player.INVENTORY_CAP&&this.block[a].type==blockType.MOVEABLE&&Phaser.Rectangle.intersects(this.block[a].sprite.getBounds(),i)&&(this.block[a].sprite.destroy(),this.block[a]=null,this.player.inventory++)}this.originPointer=null}Phaser.Rectangle.intersects(this.player.sprite.getBounds(),this.teleporter.sprite.getBounds())&&this.map.level[this.level+1]&&this.makeLevel(this.level++)},placeBlock:function(t){for(var e={x:Math.floor((t.x+game.camera.x)/this.mapGrain),y:Math.floor((t.y+game.camera.y)/this.mapGrain)},i=0,a=this.block.length;a>i;i++)if(null!=this.block[i]&&this.block[i].x==(e.x+.5)*this.mapGrain&&this.block[i].y==(e.y+.5)*this.mapGrain)return;if(this.player.inventory>0){var s=new Block(e.x,e.y,this.mapGrain,blockType.MOVEABLE);this.block.push(s),this.blockLayer.add(s.sprite),this.player.inventory--}},drawNet:function(t){this.graphics.beginFill(16711680),this.graphics.drawRect(this.camera.x+this.originPointer.x,this.camera.y+this.originPointer.y,t.x-this.originPointer.x,t.y-this.originPointer.y)},makeLevel:function(){this.block.forEach(function(t){null!=t&&t.sprite.destroy()}),this.block=[],this.teleporter&&this.teleporter.sprite.destroy(),this.player?this.player.moveToStart(this.map.level[this.level].start.x*this.mapGrain+.5,this.map.level[this.level].start.y*this.mapGrain+.5):this.player=new Player(this.map.level[this.level].start.x*this.mapGrain+.5,this.map.level[this.level].start.y*this.mapGrain+.5);for(var t=0,e=this.map.level[this.level].block.length;e>t;t++)this.block.push(new Block(this.map.level[this.level].block[t].x,this.map.level[this.level].block[t].y,this.mapGrain,this.map.level[this.level].block[t].type));this.teleporter=new Teleporter(this.map.level[this.level].teleporter.x,this.map.level[this.level].teleporter.y,this.mapGrain),game.world.setBounds(0,0,this.map.level[this.level].block[t-1].x*this.mapGrain,game.height)}},GameStates.GameOver=function(t){},GameStates.GameOver.prototype={create:function(){}},GameStates.MainMenu=function(t){this.titleText,this.playText},GameStates.MainMenu.prototype={create:function(){this.titleText=game.add.text(.25*game.width,game.world.centerY,"VERGE",textStyle.large),this.titleText.anchor.set(0,.5),this.titleText.alpha=0,this.playText=game.add.text(.25*game.width,.625*game.height,"PLAY",textStyle.normal),this.playText.anchor.set(0,.5),this.playText.alpha=0,game.add.tween(this.titleText).to({alpha:1,x:.2*game.width},500,Phaser.Easing.Quadratic.InOut,!0),game.add.tween(this.playText).to({alpha:1,x:.2*game.width},500,Phaser.Easing.Quadratic.InOut,!0,200),this.playText.inputEnabled=!0,this.playText.input.useHandCursor=!0,this.playText.events.onInputDown.add(this.play,this)},play:function(){game.add.tween(this.titleText).to({alpha:0,x:.15*game.width},500,Phaser.Easing.Quadratic.InOut,!0);var t=game.add.tween(this.playText).to({alpha:0,x:.15*game.width},500,Phaser.Easing.Quadratic.InOut,!0,200);t.onComplete.add(function(){game.state.start("Game")},this)}};var Player=function(t,e){this.sprite,this.x=t,this.y=e,this.width=25,this.height=40,this.inventory=0,this.INVENTORY_CAP=5,this.SPEED=300,this.JUMP=-450,this.create()};Player.prototype={create:function(){var t=game.add.graphics(0,0);t.beginFill(3355443),t.drawRect(0,0,this.width,this.height),this.sprite=game.add.sprite(this.x,this.y,t.generateTexture()),t.destroy(),game.physics.p2.enable(this.sprite),this.sprite.body.mass=1},update:function(){this.sprite.body.setZeroRotation(),this.sprite.body.rotation=0,this.move()},move:function(){game.input.keyboard.isDown(Phaser.Keyboard.A)||game.input.keyboard.isDown(Phaser.Keyboard.LEFT)?this.sprite.body.velocity.x=-this.SPEED:(game.input.keyboard.isDown(Phaser.Keyboard.D)||game.input.keyboard.isDown(Phaser.Keyboard.RIGHT))&&(this.sprite.body.velocity.x=this.SPEED),(game.input.keyboard.isDown(Phaser.Keyboard.W)||game.input.keyboard.isDown(Phaser.Keyboard.UP))&&(this.sprite.body.velocity.y=this.JUMP)},moveToStart:function(t,e){this.sprite.body.x=t,this.sprite.body.y=e,this.sprite.body.velocity.x=0,this.sprite.body.velocity.y=0}},GameStates.Preloader=function(t){},GameStates.Preloader.prototype={preload:function(){var t=game.add.text(.2*game.width,game.world.centerY,"LOADING",textStyle.large);t.anchor.set(0,.5),game.load.json("map","../map.json")},create:function(){game.state.start("MainMenu")}};var Teleporter=function(t,e,i){t+=.5,e+=.5,this.sprite,this.width=i,this.height=i,this.x=t*this.width,this.y=e*this.height,this.create()};Teleporter.prototype={create:function(){var t=game.add.graphics(0,0);t.beginFill(16711680),t.drawRect(0,0,this.width,this.height),this.sprite=game.add.sprite(this.x,this.y,t.generateTexture()),t.destroy(),this.sprite.anchor.set(.5)}};